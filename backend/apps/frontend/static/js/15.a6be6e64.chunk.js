(this["webpackJsonptabool-website"]=this["webpackJsonptabool-website"]||[]).push([[15],{1043:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return i})),n.d(t,"b",(function(){return o}));var c=n(15),r=function(e){var t=e.course.name,n=Object(c.c)(e.date,e.startTime),r=Object(c.c)(e.date,e.endTime);return"".concat(t,": ").concat(n.format("LT")," - ").concat(r.format("lll"))},a=function(e){return e.name},i=function(e){return"".concat(e.firstName," ").concat(e.lastName," (").concat(e.shortName,")")},o=function(e){return e.place}},1090:function(e,t,n){"use strict";n.r(t);var c=n(2),r=n(5),a=n.n(r),i=n(9),o=n(4),s=n(12),l=n(1),u=n(948),d=n(20),j=n(40),b=n(1004),O=n(230),h=n(1011),m=n(1e3),f=n(362),x=n(516),p=n(75),g=n(1017),v=n(27),k=n.n(v),y=n(61),w=n(361),C=n(1027),S=n(163),D=n(1001),E=n(11),z=n(15),I=n(1032),T=n(138),L=n(30),F=n(22),B=n(1007),U=n(37),A=n.n(U),M=n(525),_=Object(l.createContext)(null),R=n(1008),V=n(1012),H=n(1044),N=n(305),P=n(1036),K=n(1057),W=n(951),$=n(1002),G=n(953),Q=n(954),Z=n(1093),q=n(55),J=function(e){var t=e.color,n=e.dayComponent,c=Object(q.a)(),r=Object(d.a)(t,c.palette.background.paper),a=Object(s.a)(r,2),i=a[0],o=a[1];return Object(l.cloneElement)(n,{style:{color:i,backgroundColor:o}})},X=Object(l.memo)(J),Y=function(e){var t,n=e.isOpen,r=e.onChange,a=e.onClose,i=e.value,o=Object(u.a)().t,j=Object(l.useContext)(_).lesson,b=Object(d.g)(null!==(t=i.uploadDate)&&void 0!==t?t:null),O=Object(s.a)(b,2),h=O[0],m=O[1],f=k()(),g=j.course.subject.userRelation.color,v=j.course.weekdays;return Object(c.jsxs)(W.a,{open:n,onBackdropClick:a,children:[Object(c.jsx)($.a,{children:o("Hochladedatum ausw\xe4hlen")}),Object(c.jsxs)(G.a,{children:[Object(c.jsx)(p.a,{variant:"body2",color:"textSecondary",children:o("Hochgeladene Dateien werden von tabool nicht direkt auf Scooso hochgeladen. Du kannst ausw\xe4hlen, wann die Datei automatisch auf Scooso hochgeladen werden soll.")}),Object(c.jsx)(x.a,{mt:3,display:"flex",justifyContent:"center",children:Object(c.jsx)(Z.a,{disablePast:!0,inputVariant:"outlined",value:h,format:"lll",renderDay:function(e,t,n,r){var a;return e&&t&&!e.isSame(t)&&!e.isBefore(f)&&g&&(null===v||void 0===v||null===(a=v.includes)||void 0===a?void 0:a.call(v,e.day()-1))?Object(c.jsx)(X,{color:g,dayComponent:r}):r},InputProps:{endAdornment:null!==i.uploadDate&&Object(c.jsx)(N.a,{edge:"end",onClick:function(e){e.stopPropagation(),m(null)},children:Object(c.jsx)(S.l,{})})},onChange:function(e){return e&&m(e)}})})]}),Object(c.jsx)(Q.a,{children:Object(c.jsx)(y.L,{disabled:h===i.uploadDate,onClick:function(){a(),r(A()(i,{uploadDate:{$set:null!==h&&void 0!==h?h:null}}))},children:o("\xc4nderungen speichern")})})]})},ee=n(1010),te=n(237),ne=n.n(te),ce={display:"flex",alignItems:"center",style:{wordBreak:"break-word"}},re=function(e){var t=e.icon,n=e.text;return Object(c.jsxs)(x.a,Object(o.a)(Object(o.a)({},ce),{},{children:[Object(c.jsx)(x.a,{mr:1,children:t}),n]}))},ae={wordBreak:"break-all"},ie=function(e){var t=e.filename,n=e.creationDate,r=e.size,a=e.uploadDate,i=e.isFileUploading,o=Object(u.a)().t;return Object(c.jsx)(ee.a,{style:ae,primary:t,secondary:Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(re,{text:ne()(r,{locale:"de"})}),n&&Object(c.jsx)(re,{icon:Object(c.jsx)(S.b,{}),text:n.format("lll")}),a&&Object(c.jsx)(re,{icon:Object(c.jsx)(S.w,{}),text:a.format("lll")}),i&&Object(c.jsx)(re,{icon:Object(c.jsx)(S.m,{}),text:o("Wird gerade auf Scooso hochgeladen")})]})})},oe=Object(l.memo)(ie),se={maxSizeMB:1,useWebWorker:!0},le=function(e,t){var n=e.onSettingsChange,r=e.settings,d=e.nativeFile,b=e.onDone,O=e.compressImages,h=e.onDelete,m=Object(u.a)().t,f=Object(l.useContext)(_),x=f.submissions,p=f.onSubmissionsChange,g=f.lesson,v=Object(j.P)(),k=Object(l.useState)(0),w=Object(s.a)(k,2),C=w[0],D=w[1],E=Object(l.useState)(),T=Object(s.a)(E,2),F=T[0],B=T[1],U=Object(l.useState)(!1),A=Object(s.a)(U,2),M=A[0],W=A[1],$=Object(l.useState)(!1),G=Object(s.a)($,2),Q=G[0],Z=G[1],q=Object(P.a)(v,{onSuccess:function(e){p([].concat(Object(L.a)(x),[e])),b()},onError:function(e){return B(e.message)}}),J=q.mutate,X=q.isLoading;return Object(l.useImperativeHandle)(t,(function(){return{upload:function(){var e=Object(i.a)(a.a.mark((function e(){var t,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=null,B(void 0),!O||!d.type.startsWith("image")){e.next=18;break}return W(!0),e.prev=4,e.next=7,Object(K.a)(d,Object(o.a)(Object(o.a)({},se),{},{onProgress:D}));case 7:t=e.sent,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(4),B(m("Das Bild konnte nicht komprimiert werden."));case 13:return e.prev=13,W(!1),e.finish(13);case 16:e.next=28;break;case 18:return e.prev=18,e.next=21,d.arrayBuffer();case 21:n=e.sent,t=new Blob([n],{type:d.type}),e.next=28;break;case 25:e.prev=25,e.t1=e.catch(18),B(m("Die Datei konnte nicht gelesen werden."));case 28:t&&J({file:t,uploadDate:r.uploadDate?Object(z.i)(r.uploadDate):null,lessonId:g.id});case 29:case"end":return e.stop()}}),e,null,[[4,10,13,16],[18,25]])})));return function(){return e.apply(this,arguments)}}()}})),Object(c.jsxs)(y.F,{isLoading:X||M,text:m(M?"Bild wird komprimiert":"Bild wird hochgeladen"),value:M?C:void 0,children:[Object(c.jsxs)(R.a,{button:!0,onClick:h,children:[Object(c.jsx)(V.a,{children:Object(c.jsx)(y.q,{name:d.name})}),Object(c.jsx)(oe,{filename:d.name,uploadDate:r.uploadDate,size:d.size}),Object(c.jsx)(H.a,{children:Object(c.jsx)(N.a,{onClick:function(){return Z(!0)},children:Object(c.jsx)(S.M,{})})})]}),F&&Object(c.jsx)(I.a,{severity:"error",children:F}),Object(c.jsx)(Y,{value:r,isOpen:Q,onChange:n,onClose:function(){return Z(!1)}})]})},ue=Object(l.forwardRef)(le),de=n(958),je=n(515),be=n(1003),Oe=n(1023),he=function(e){var t=e.isOpen,n=e.onClose,r=e.onActivateCompression,a=Object(u.a)().t;return Object(c.jsxs)(W.a,{open:t,onBackdropClick:n,children:[Object(c.jsx)($.a,{children:a("Bilder komprimieren")}),Object(c.jsxs)(G.a,{children:[Object(c.jsx)(be.a,{children:Object(c.jsxs)(Oe.a,{children:["Dank moderner Technologie ",Object(c.jsx)(b.a,{href:"https://webassembly.org/",target:"_blank",rel:"noopener noreferrer",children:"(WebAssembly)"})," ","ist es heutzutage m\xf6glich sogar Bilder auf einem Smartphone, anstatt auf dem Server, zu komprimieren. Somit werden bis zu ",Object(c.jsx)("strong",{children:"80% mobile Daten gespart"}),"."]})}),Object(c.jsx)(be.a,{children:a("Leider ist diese Technologie noch nicht bei allen Browsern implementiert. Momentan wird sie nur von der neuesten Chrome-Version unterst\xfctzt.")}),Object(c.jsx)(I.a,{severity:M.a?"success":"error",children:M.a?a("Dein Browser unterst\xfctzt WebAssembly!"):a("Dein Browser unterst\xfctzt nicht WebAssembly")})]}),Object(c.jsxs)(Q.a,{children:[Object(c.jsx)(y.L,{disabled:!M.a,onClick:r,children:a("Bildkomprimierung aktivieren")}),Object(c.jsx)(y.Q,{onClick:n,children:a("Schlie\xdfen")})]})]})},me=Object(l.memo)(he),fe=function(e){var t=e.compressImages,n=e.containsImages,r=e.onCompressImagesChange,a=e.onUpload,i=Object(u.a)().t,o=Object(l.useState)(!1),d=Object(s.a)(o,2),j=d[0],b=d[1];return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsxs)(x.a,{m:2,component:"aside",children:[Object(c.jsxs)(h.a,{container:!0,spacing:1,direction:"row",children:[Object(c.jsx)(h.a,{item:!0,children:Object(c.jsx)(y.L,{startIcon:Object(c.jsx)(S.w,{}),onClick:a,children:i("Hochladen")})}),n&&Object(c.jsx)(h.a,{item:!0,children:Object(c.jsx)(de.a,{label:Object(c.jsxs)(c.Fragment,{children:[i("Bilder komprimieren"),Object(c.jsx)(N.a,{size:"small",onClick:function(){return b(!0)},children:Object(c.jsx)(S.z,{})})]}),control:Object(c.jsx)(je.a,{color:"primary",disabled:!M.a,checked:t,onChange:function(e){return r(e.target.checked)}})})})]}),Object(c.jsx)(p.a,{variant:"body2",color:"textSecondary",children:i("Tippe auf ein Element, um es zu entfernen.")})]}),Object(c.jsx)(me,{isOpen:j,onClose:function(){return b(!1)},onActivateCompression:function(){r(!0),b(!1)}})]})},xe=Object(l.memo)(fe),pe=function(){var e=Object(l.useContext)(_).lesson,t=Object(l.useRef)([]),n=Object(l.useState)([]),r=Object(s.a)(n,2),a=r[0],i=r[1],o=Object(l.useState)(M.a),u=Object(s.a)(o,2),d=u[0],j=u[1],b=Object(l.useMemo)((function(){var t=e.startTime,n=e.endTime,c=e.course.weekdays.map((function(e){return{weekday:e,startTime:t,endTime:n}}));return Object(z.k)(k()(),c)}),[e.startTime,e.endTime,e.course.weekdays,e.date]),O=a.some((function(e){return e.nativeFile.type.startsWith("image")})),h=function(){t.current.forEach((function(e){return e.upload()}))};return Object(l.useEffect)((function(){t.current=Array(a.length)}),[a]),Object(c.jsx)(c.Fragment,{children:Object(c.jsx)(y.m,{value:a,renderList:function(e){return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(B.a,{children:e.map((function(n,r){var a;return Object(c.jsx)("div",{children:Object(c.jsx)(ue,{ref:function(e){return t.current[r]=e},nativeFile:n.nativeFile,compressImages:d,settings:{uploadDate:n.uploadDate},onSettingsChange:function(t){var n;return i(A()(e,Object(F.a)({},r,{uploadDate:{$set:null!==(n=t.uploadDate)&&void 0!==n?n:null}})))},onDone:function(){return i(A()(e,{$splice:[[r,1]]}))},onDelete:function(){return i(A()(e,{$splice:[[r,1]]}))}})},"submission_add_".concat(n.nativeFile.name,"_").concat(n.nativeFile.size,"_").concat(null===(a=n.uploadDate)||void 0===a?void 0:a.toISOString()))}))}),Object(c.jsx)(xe,{compressImages:d,containsImages:O,onCompressImagesChange:j,onUpload:h})]})},onChange:function(e){return i((function(t){return[].concat(Object(L.a)(t),Object(L.a)(Array.from(e).map((function(e){return{nativeFile:e,uploadDate:b}}))))}))}})})},ge=Object(l.memo)(pe),ve=n(1058),ke=n.n(ve),ye=n(1045),we=n(8),Ce=n(950),Se={wordBreak:"break-all"},De=function(e){var t=e.amount,n=e.filename,r=e.isOpen,a=e.onClose,i=e.onConfirm,o=Object(u.a)().t;return Object(c.jsx)(y.S,{isOpen:r,primaryButton:Object(c.jsx)(y.L,{onClick:i,children:o("L\xf6schen")}),title:o("Datei(en) l\xf6schen"),onClose:a,children:Object(c.jsx)(be.a,{children:n?Object(c.jsxs)(Oe.a,{children:["M\xf6chtest du wirklich die Datei ",Object(c.jsx)(x.a,{m:2,style:Se,children:Object(c.jsx)("i",{children:{filename:n}})})," l\xf6schen?"]}):Object(c.jsxs)(Oe.a,{count:t,children:["M\xf6chtest du wirklich ",Object(c.jsx)("strong",{children:{amount:t}})," Dateien l\xf6schen?"]})})})},Ee=function(e){var t=e.isOpen,n=e.onClose,r=e.onDelete,a=e.submission,i=e.onShowSettings,o=e.onUploadToScooso,d=e.isFileUploading,j=Object(u.a)().t,O=Object(l.useState)(!1),h=Object(s.a)(O,2),m=h[0],f=h[1];return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsxs)(y.e,{title:a.filename,description:j("Eingestellt am {{date}}",{date:a.createdAt.format("LLL")}),isOpen:t,onClose:n,children:[Object(c.jsxs)(R.a,{button:!0,disabled:a.isUploaded||d,onClick:function(){n(),i()},children:[Object(c.jsx)(V.a,{children:Object(c.jsx)(S.M,{size:"1.5rem"})}),Object(c.jsx)(ee.a,{children:j("Einstellungen")})]}),Object(c.jsx)(b.a,{download:!0,underline:"none",color:"inherit",href:a.file,children:Object(c.jsxs)(R.a,{button:!0,children:[Object(c.jsx)(V.a,{children:Object(c.jsx)(S.v,{size:"1.5rem"})}),Object(c.jsx)(ee.a,{children:j("Datei runterladen")})]})}),Object(c.jsxs)(R.a,{button:!0,disabled:a.isUploaded||d,onClick:function(){n(),o()},children:[Object(c.jsx)(V.a,{children:Object(c.jsx)(S.m,{size:"1.5rem"})}),Object(c.jsx)(ee.a,{children:j("Datei auf Scooso hochladen")}),d&&Object(c.jsx)(H.a,{children:Object(c.jsx)(Ce.a,{color:"inherit",size:"1rem"})})]}),Object(c.jsxs)(R.a,{button:!0,onClick:function(){f(!0),n()},children:[Object(c.jsx)(V.a,{children:Object(c.jsx)(S.o,{size:"1.5rem"})}),Object(c.jsx)(ee.a,{children:j("Datei l\xf6schen")})]})]}),Object(c.jsx)(De,{filename:a.filename,isOpen:m,onClose:function(){return f(!1)},onConfirm:function(){f(!1),r()}})]})},ze=n(123),Ie=n(1060),Te=function(e){var t=Object(u.a)().t,n=Object(ze.b)().addError,c=Object(j.D)(),r=Object(j.V)(),o=Object(j.X)(),s=Object(j.g)(),l=Object(D.a)("get_submission_status_".concat(e.id),(function(){return c(e.id)})),d=l.data,b=l.refetch;Object(Ie.useInterval)((function(){(null===d||void 0===d?void 0:d.uploadStatus)===we.c.Pending&&b()}),3e3);var O=Object(P.a)(function(){var t=Object(i.a)(a.a.mark((function t(n){var c,i;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(null===e.uploadDate&&null===n.uploadDate||n.uploadDate&&(null===(c=e.uploadDate)||void 0===c||null===(i=c.isSame)||void 0===i?void 0:i.call(c,n.uploadDate)))){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,r(e.id,n);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),{onError:function(e){return n(e,void 0,ze.a.ErrorMutating)}}),h=O.mutateAsync,m=O.isLoading,f=Object(P.a)(Object(i.a)(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isUploaded){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,o(e.id);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)}))),{onError:function(e){var c;502===(null===(c=e.response)||void 0===c?void 0:c.status)?n(t("Scooso hat die Datei abgelehnt. (Vielleicht ung\xfcltige Datei oder Upload-Limit erreicht?)")):n(e,void 0,ze.a.ErrorUploading)}}),x=f.mutateAsync,p=f.isLoading,g=f.isSuccess;return{update:h,upload:x,isUpdatingSettings:m,delete:Object(P.a)((function(){return s(e.id)}),{onError:function(e){return n(e,void 0,ze.a.ErrorMutating)}}).mutateAsync,status:g?we.c.Uploaded:p?we.c.Pending:(null===d||void 0===d?void 0:d.uploadStatus)?d.uploadStatus:we.c.Resting}},Le=function(e,t){var n=e.submission,r=e.iconElement,a=e.onUpdate,i=e.onDeleted,o=e.onUploaded,d=Object(u.a)().t,j=Te(n),b=j.update,O=j.upload,h=j.isUpdatingSettings,m=j.status,f=j.delete,x=Object(l.useState)(!1),p=Object(s.a)(x,2),g=p[0],v=p[1],k=Object(l.useState)(!1),w=Object(s.a)(k,2),C=w[0],D=w[1],E=m===we.c.Pending;return Object(l.useImperativeHandle)(t,(function(){return{upload:function(){return O().then((function(e){return o(Boolean(e))}))},delete:function(e){return f(e).then(i)},resetUploadDate:function(){return b({uploadDate:null}).then(a)}}})),Object(c.jsxs)(c.Fragment,{children:[Object(c.jsxs)(y.F,{isLoading:h,children:[Object(c.jsxs)(R.a,{children:[r,Object(c.jsx)(oe,{filename:n.filename,creationDate:n.createdAt,uploadDate:n.uploadDate,size:n.size,isFileUploading:E}),Object(c.jsx)(H.a,{children:Object(c.jsx)(N.a,{edge:"end",onClick:function(){return D(!0)},children:Object(c.jsx)(S.E,{})})})]}),m===we.c.Uploaded&&Object(c.jsx)(I.a,{severity:"success",children:d("Datei wurde auf Scooso hochgeladen")}),E&&Object(c.jsx)(ye.a,{})]}),Object(c.jsx)(Y,{value:{uploadDate:n.uploadDate},isOpen:g,onChange:function(e){return b(e).then(a)},onClose:function(){return v(!1)}}),Object(c.jsx)(Ee,{submission:n,isOpen:C,isFileUploading:E,onClose:function(){return D(!1)},onDelete:function(){return f().then(i)},onShowSettings:function(){return v(!0)},onUploadToScooso:function(){return O().then((function(e){return o(Boolean(e))}))}})]})},Fe=Object(l.forwardRef)(Le),Be={wordBreak:"break-all"},Ue=function(e){var t=e.amount,n=e.filename,r=e.isOpen,a=e.onClose,i=e.onConfirm,o=Object(u.a)().t;return Object(c.jsx)(y.S,{isOpen:r,primaryButton:Object(c.jsx)(y.L,{onClick:i,children:o("Hochladen")}),title:o("Datei(en) hochladen"),onClose:a,children:Object(c.jsx)(be.a,{children:n?Object(c.jsxs)(Oe.a,{children:["M\xf6chtest du wirklich die Datei",Object(c.jsx)(x.a,{m:2,style:Be,children:Object(c.jsx)("i",{children:{filename:n}})})," hochladen?"]}):Object(c.jsxs)(Oe.a,{count:t,children:["M\xf6chtest du wirklich ",Object(c.jsx)("strong",{children:{amount:t}})," Dateien hochladen?"]})})})},Ae={wordBreak:"break-all"},Me=function(e){var t=e.amount,n=e.filename,r=e.isOpen,a=e.onClose,i=e.onConfirm,o=Object(u.a)().t;return Object(c.jsx)(y.S,{isOpen:r,primaryButton:Object(c.jsx)(y.L,{onClick:i,children:o("Zur\xfccksetzen")}),title:o("Hochladedaten zur\xfccksetzen"),onClose:a,children:Object(c.jsx)(be.a,{children:n?Object(c.jsxs)(Oe.a,{children:["M\xf6chtest du wirklich das Hochladedatum der Datei",Object(c.jsx)(x.a,{m:2,style:Ae,children:Object(c.jsx)("i",{children:{filename:n}})})," zur\xfccksetzen?"]}):Object(c.jsxs)(Oe.a,{count:t,children:["M\xf6chtest du wirklich die Hochladedaten ",Object(c.jsx)("strong",{children:{amount:t}})," Dateien zur\xfccksetzen?"]})})})},_e=function(){var e=Object(u.a)().t,t=Object(l.useContext)(_),n=t.submissions,r=t.onSubmissionsChange,o=Object(l.useState)(!1),j=Object(s.a)(o,2),b=j[0],h=j[1],m=Object(l.useState)(!1),f=Object(s.a)(m,2),x=f[0],g=f[1],v=Object(l.useState)(!1),k=Object(s.a)(v,2),w=k[0],C=k[1],D=Object(l.useState)([]),E=Object(s.a)(D,2),z=E[0],I=E[1],T=Object(l.useRef)({}),L=Object.entries(T.current).filter((function(e){var t=Object(s.a)(e,2),n=t[0];t[1];return z.includes(n)})).map((function(e){var t=Object(s.a)(e,2);t[0];return t[1]})),B=n.filter((function(e){return z.includes(e.id)})),U=B.reduce((function(e,t){return e+t.size}),0),M=Object(d.l)(U,0),R=function(){return I([])},V=function(e){return n.findIndex((function(t){return e.id===t.id}))},H=B.every((function(e){return e.isUploaded})),N=B.every((function(e){return e.isUploaded||!e.uploadDate}));return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(y.R,{selectedKeys:z,data:n,getElementKey:function(e){return e.id},renderIcon:function(e){return Object(c.jsx)(y.q,{name:e.filename})},formFooter:Object(c.jsxs)(p.a,{color:"textSecondary",variant:"body2",children:[e("Gr\xf6\xdfe aller Dateien: "),Object(c.jsx)(ke.a,{start:M,end:U,formattingFn:function(e){return ne()(e,{locale:"de"})},duration:.8})]}),formElements:[Object(c.jsx)(O.a,{startIcon:Object(c.jsx)(S.o,{}),onClick:function(){return h(!0)},children:e("L\xf6schen")},"delete_selected_submissions"),Object(c.jsx)(O.a,{startIcon:Object(c.jsx)(S.m,{}),disabled:H,onClick:function(){return g(!0)},children:e("Hochladen")},"upload_selected_submissions"),Object(c.jsx)(O.a,{startIcon:Object(c.jsx)(S.k,{}),disabled:N,onClick:function(){return C(!0)},children:e("Datum zur\xfccksetzen")},"upload_selected_submissions")],renderElement:function(e,t){return Object(c.jsx)(Fe,{ref:function(t){t&&(T.current[e.id]=t)},submission:e,iconElement:t,onUploaded:function(){var t=Object(i.a)(a.a.mark((function t(c){var i,o;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:c&&(i=V(e),o=A()(n,Object(F.a)({},i,{isUploaded:{$set:!0}})),r(o));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),onUpdate:function(){var t=Object(i.a)(a.a.mark((function t(c){var i,o;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:c&&(i=V(e),o=A()(n,Object(F.a)({},i,{$set:c})),r(o));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),onDeleted:Object(i.a)(a.a.mark((function t(){var c,i;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:c=V(e),i=A()(n,{$splice:[[c,1]]}),r(i);case 3:case"end":return t.stop()}}),t)})))})},onSelectedKeysChange:I}),Object(c.jsx)(De,{isOpen:b,filename:1===B.length?n[0].filename:void 0,amount:z.length,onConfirm:function(){h(!1),R(),L.forEach((function(e){return e.delete()}))},onClose:function(){return h(!1)}}),Object(c.jsx)(Ue,{isOpen:x,filename:1===B.length?n[0].filename:void 0,amount:z.length,onConfirm:function(){g(!1),R(),L.forEach((function(e){return e.upload()}))},onClose:function(){return g(!1)}}),Object(c.jsx)(Me,{isOpen:w,filename:1===B.length?n[0].filename:void 0,amount:z.length,onConfirm:function(){C(!1),R(),L.forEach((function(e){return e.resetUploadDate()}))},onClose:function(){return C(!1)}})]})},Re=function(e){var t=e.lesson,n=Object(d.g)(t.submissions),r=Object(s.a)(n,2),a=r[0],i=r[1];return Object(c.jsxs)(_.Provider,{value:{lesson:t,submissions:a,onSubmissionsChange:i},children:[a.length>0&&Object(c.jsx)(_e,{}),Object(c.jsx)(ge,{})]})},Ve=Object(l.memo)(Re),He=n(1051),Ne=n(1047),Pe=n(1048),Ke=n(1022),We=n(1043),$e=n(1082),Ge=function(e){var t=e.text,n=Object(q.a)(),r=Object(l.useMemo)((function(){return{backgroundColor:n.palette.background.default,borderRadius:n.shape.borderRadius}}),[n.palette.background.default,n.shape.borderRadius]);return Object(c.jsx)(x.a,{p:2,style:r,children:Object(c.jsxs)(h.a,{container:!0,spacing:2,direction:"row",wrap:"nowrap",alignItems:"center",children:[Object(c.jsx)(h.a,{item:!0,children:Object(c.jsx)(p.a,{variant:"body1",color:"textSecondary",children:Object(c.jsx)(w.H,{})})}),Object(c.jsx)(h.a,{item:!0,children:Object(c.jsx)(p.a,{variant:"body1",color:"textSecondary",children:t})})]})})},Qe=Object(l.memo)(Ge),Ze=function(e){var t=e.lesson,n=e.modification,r=Object(q.a)(),a=Object(d.h)(n.modificationType),i=Object(l.useMemo)((function(){return{opacity:r.palette.action.disabledOpacity,color:r.palette.error.main,textDecoration:"line-through"}}),[r.palette.action.disabledOpacity,r.palette.error.main]),o=Object(l.useMemo)((function(){return{color:r.palette.success.main}}),[r.palette.success.main]),s=[n.newSubject&&{key:"subject",icon:Object(c.jsx)(T.f,{}),oldValue:Object(We.c)(t.course.subject),newValue:Object(We.c)(n.newSubject)},n.newTeacher&&{key:"teacher",icon:Object(c.jsx)(T.g,{}),oldValue:Object(We.d)(t.course.teacher),newValue:Object(We.d)(n.newTeacher)},n.newRoom&&{key:"room",icon:Object(c.jsx)(S.I,{}),oldValue:Object(We.b)(t.room),newValue:Object(We.b)(n.newRoom)}].filter(Boolean);return Object(c.jsxs)(h.a,{container:!0,direction:"column",spacing:2,children:[Object(c.jsx)(h.a,{item:!0,children:Object(c.jsx)(p.a,{variant:"h6",color:"textSecondary",children:Object(c.jsxs)(Oe.a,{children:[Object(c.jsx)("b",{children:"Ver\xe4nderungsart:"})," ",a]})})}),Object(c.jsx)(h.a,{item:!0,children:n.information&&Object(c.jsx)(Qe,{text:n.information})}),Object(c.jsx)(h.a,{item:!0,children:Object(c.jsx)(h.a,{container:!0,children:s.map((function(e){var t=e.key,n=e.oldValue,r=e.newValue,a=e.icon;return Object(c.jsx)(h.a,{item:!0,children:Object(c.jsx)(p.a,{variant:"body1",color:"textSecondary",children:Object(c.jsxs)(h.a,{container:!0,spacing:1,alignItems:"center",children:[a,Object(c.jsx)(h.a,{item:!0,style:i,children:n}),Object(c.jsx)($e.a,{}),Object(c.jsx)(h.a,{item:!0,style:o,children:r})]})})},t)}))})})]})},qe=Object(l.memo)(Ze),Je=function(e){var t=e.lesson,n=Object(u.a)().t,r=Object(l.useState)(!0),a=Object(s.a)(r,2),i=a[0],o=a[1],d=Object(z.c)(t.date,t.startTime),j=Object(z.c)(t.date,t.endTime);return Object(c.jsxs)(He.a,{expanded:i,onClick:function(){return o((function(e){return!e}))},children:[Object(c.jsx)(Ne.a,{expandIcon:Object(c.jsx)(S.u,{}),children:Object(c.jsx)(p.a,{variant:"h4",children:Object(c.jsxs)(h.a,{container:!0,spacing:1,alignItems:"center",children:[Object(c.jsx)(h.a,{item:!0,children:Object(c.jsx)(w.r,{})}),Object(c.jsx)(h.a,{item:!0,children:n("Ver\xe4nderungen")})]})})}),Object(c.jsx)(Pe.a,{children:function(){if(1===t.modifications.length){var e=t.modifications[0];if(d.isSame(e.startDatetime)&&j.isSame(e.endDatetime))return Object(c.jsx)(qe,{lesson:t,modification:e})}return Object(c.jsx)(h.a,{container:!0,spacing:4,direction:"column",children:t.modifications.map((function(e,r){return Object(c.jsxs)(h.a,{item:!0,children:[Object(c.jsx)(p.a,{variant:"h5",children:n("{{indexNumber}} Ver\xe4nderung von {{startTime}} bis {{endTime}}",{startTime:e.startDatetime.format("LT"),endTime:e.endDatetime.format("LT"),indexNumber:"".concat(r+1,".")})}),Object(c.jsx)(x.a,{my:2,children:Object(c.jsx)(qe,{lesson:t,modification:e})}),Object(c.jsx)(Ke.a,{})]},e.id)}))})}()})]})},Xe=Object(l.memo)(Je),Ye=function(e,t){var n=Object(j.G)(),c=Object(j.c)(),r=Object(j.Q)(),a=Object(d.o)().addError;return{add:Object(P.a)((function(){if(!t)throw new TypeError("Lesson not loaded");if(t.absence)throw new TypeError("Absence already exists");return n({lessonId:t.id})}),{onError:function(e){return a(e,void 0,ze.a.ErrorMutating)},onSuccess:e}).mutateAsync,remove:Object(P.a)((function(){var e;if(!t)throw new TypeError("Lesson not loaded");if(!(null===(e=t.absence)||void 0===e?void 0:e.id))throw new TypeError("Absence does not exist");return c(t.absence.id)}),{onError:function(e){return a(e,void 0,ze.a.ErrorMutating)},onSuccess:function(){return e(null)}}).mutateAsync,update:Object(P.a)((function(e){var n;if(!t)throw new TypeError("Lesson not loaded");if(!(null===(n=t.absence)||void 0===n?void 0:n.id))throw new TypeError("Absence does not exist");return r(t.absence.id,e)}),{onError:function(e){return a(e,void 0,ze.a.ErrorMutating)},onSuccess:e}).mutateAsync}},et=n(67),tt=n(232),nt=function(e){var t,n,r=e.onSubmit,a=e.absence,i=Object(u.a)().t;return Object(c.jsx)(f.a,{children:Object(c.jsxs)(x.a,{p:2,children:[Object(c.jsx)(et.d,{enableReinitialize:!0,initialValues:{reason:null!==(t=null===a||void 0===a?void 0:a.reason)&&void 0!==t?t:"",isSigned:null!==(n=null===a||void 0===a?void 0:a.isSigned)&&void 0!==n&&n},onSubmit:r,children:function(e){var t=e.isSubmitting,n=e.submitForm;return Object(c.jsx)(et.c,{children:Object(c.jsx)(y.F,{isLoading:t,children:Object(c.jsxs)(h.a,{container:!0,spacing:1,alignItems:"center",justify:"center",children:[Object(c.jsx)(h.a,{item:!0,xs:12,md:6,children:Object(c.jsx)(et.b,{type:"text",name:"reason",label:i("Grund"),component:y.a})}),Object(c.jsx)(h.a,{item:!0,xs:12,md:6,children:Object(c.jsx)(et.b,{name:"isSigned",Label:{label:i("Unterschrieben")},component:tt.a,onChange:n})})]})})})}}),Object(c.jsx)(x.a,{my:2,children:Object(c.jsx)(Ke.a,{})}),Object(c.jsx)(O.a,{startIcon:Object(c.jsx)(w.N,{}),href:Object(z.a)("/agenda/absence/"),children:i("Zur Entschuldigungsliste")})]})})},ct={width:"100%"};t.default=function(e){var t,n,r=e.match.params.id,v=Object(u.a)().t,L=Object(d.m)(),F=Object(j.p)(),B=Object(d.c)().onFetchError,U=Object(l.useContext)(E.b).dispatch,A=Object(l.useState)(),M=Object(s.a)(A,2),_=M[0],R=M[1],V=Object(l.useCallback)((function(e){return R((function(t){return Object(o.a)(Object(o.a)({},t),{},{absence:e})}))}),[]),H=Object(D.a)("fetch_lesson_".concat(r),(function(){return F(r)}),Object(o.a)(Object(o.a)({},L),{},{onSuccess:R,onError:function(e){return B(e,Boolean(_))}})),N=H.isLoading,P=H.dataUpdatedAt,K=H.refetch,W=H.isFetching,$=Ye(V,_);if(N)return Object(c.jsx)(y.G,{title:v("Stunde wird geladen...")});if(!_)return U({type:"setError",payload:{}}),null;var G=_.date.format("ll"),Q=Object(z.c)(_.date,_.startTime).format("LT"),Z=Object(z.c)(_.date,_.endTime).format("LT"),q="".concat(G,", ").concat(Q," - ").concat(Z),J=_.videoConferenceLink;return Object(c.jsx)(y.l,{title:_.course.name,subTitle:q,color:_.course.subject.userRelation.color,defaultOrdering:["presenceContent","distanceContent","room","teacher","course"],orderingStorageName:"detail:ordering:lesson",refetch:K,isRefreshing:W,updatedAt:k()(P),data:{presenceContent:{icon:Object(c.jsx)(w.l,{}),title:v("Inhalt Pr\xe4senzunterricht"),information:null===(t=_.classbook)||void 0===t?void 0:t.presenceContent},distanceContent:{icon:Object(c.jsx)(C.d,{}),title:v("Inhalt Fernunterricht"),information:null===(n=_.classbook)||void 0===n?void 0:n.distanceContent},course:{icon:Object(c.jsx)(T.a,{}),title:v("Kurs"),information:_.course.name,disableShowMore:!0},teacher:{icon:Object(c.jsx)(T.g,{}),title:v("Lehrer"),information:"".concat(_.course.teacher.firstName," ").concat(_.course.teacher.lastName),disableShowMore:!0,helperText:Object(c.jsx)(b.a,{component:O.a,underline:"none",href:Object(z.a)("/agenda/teacher/detail/:id/",{id:_.course.teacher.id}),children:v("Zum Lehrer")})},room:{icon:Object(c.jsx)(S.I,{}),title:v("Raum"),information:_.room.place,disableShowMore:!0}},headerNode:(null===_||void 0===_?void 0:_.modifications.length)>0&&Object(c.jsx)(Xe,{lesson:_}),relationButtons:{values:{attendance:{title:v("Anwesend"),isActive:!_.absence,icon:Object(c.jsx)(w.R,{})}},onSubmit:function(){var e=Object(i.a)(a.a.mark((function e(t,n){var c,r,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=t.attendance,r=n.resetForm,i=n.setSubmitting,e.prev=2,!c){e.next=8;break}return e.next=6,$.remove();case 6:e.next=10;break;case 8:return e.next=10,$.add();case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r();case 15:return e.prev=15,i(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},renderTopField:function(e){return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(h.a,{item:!0,children:e}),Object(c.jsx)(h.a,{item:!0,children:J&&Object(c.jsx)(b.a,{href:J,rel:"noopener noreferrer",component:O.a,underline:"none",target:"_blank",startIcon:Object(c.jsx)(w.gb,{}),children:v("Video-Konferenz \xf6ffnen")})})]})},bottomNode:[Object(c.jsx)(m.a,{in:Boolean(_.absence),children:Object(c.jsx)(nt,{absence:_.absence,onSubmit:function(e,t){var n=t.setSubmitting;return $.update(e).finally((function(){return n(!1)}))}})},"write_illness_email_".concat(_.id)),Object(c.jsx)(f.a,{elevation:0,children:Object(c.jsxs)(x.a,{p:3,children:[Object(c.jsx)(p.a,{variant:"h2",children:v("Materialien")}),_.materials.length>0?Object(c.jsx)(h.a,{container:!0,spacing:1,children:_.materials.map((function(e){return Object(c.jsx)(h.a,{item:!0,style:ct,children:e.size?Object(c.jsx)(y.H,{id:e.id,name:e.name,addedAt:e.addedAt,size:e.size,isDeleted:e.isDeleted},e.id):Object(c.jsx)(y.P,{name:e.name,id:e.id},e.id)},e.id)}))}):Object(c.jsx)(I.a,{severity:"info",children:v("Keine Materialien verf\xfcgbar.")})]})},"materials"),Object(c.jsx)(f.a,{elevation:0,children:Object(c.jsxs)(x.a,{p:3,children:[Object(c.jsx)(p.a,{variant:"h2",children:v("Hausaufgaben")}),_.homeworks.length>0?Object(c.jsx)(h.a,{container:!0,spacing:1,children:_.homeworks.map((function(e){return Object(c.jsx)(h.a,{item:!0,style:ct,children:Object(c.jsx)(y.v,{subject:_.course.subject,information:e.truncatedInformation,id:e.id,creationDate:e.createdAt})},e.id)}))}):Object(c.jsxs)(x.a,{alignItems:"center",justifyContent:"center",display:"flex",flexDirection:"column",children:[Object(c.jsx)(x.a,{mb:2,children:Object(c.jsx)(I.a,{severity:"info",children:v("Keine Hausaufgaben, yay!")})}),Object(c.jsx)(y.Q,{startIcon:Object(c.jsx)(S.b,{}),href:Object(z.a)("/agenda/add/homework/"),children:v("Hausaufgabe hinzuf\xfcgen")})]})]})},"homeworks"),Object(c.jsx)(f.a,{elevation:0,children:Object(c.jsxs)(x.a,{p:3,children:[Object(c.jsx)(p.a,{variant:"h2",children:v("Einsendungen")}),Object(c.jsx)(Ve,{lesson:_})]})},"submissions"),Object(c.jsx)("div",{children:Object(c.jsx)(x.a,{display:"flex",justifyContent:"center",alignItems:"center",children:Object(c.jsxs)(g.a,{variant:"outlined",orientation:"vertical",children:[Object(c.jsx)(b.a,{underline:"none",component:O.a,startIcon:Object(c.jsx)(T.c,{}),href:Object(z.a)("/add/homework/",void 0,{lesson:_.id}),children:v("Hausaufgabe hinzuf\xfcgen")}),Object(c.jsx)(b.a,{underline:"none",component:O.a,startIcon:Object(c.jsx)(T.b,{}),href:Object(z.a)("/add/exam/",void 0,{course:_.course.id,place:_.room.id}),children:v("Klassenarbeit hinzuf\xfcgen")})]})})},"actions")]})}}}]);