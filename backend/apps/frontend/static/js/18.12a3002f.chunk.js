(this["webpackJsonptabool-website"]=this["webpackJsonptabool-website"]||[]).push([[18],{1044:function(e,t,n){"use strict";var c=n(3),a=n(10),r=n(1),s=(n(6),n(7)),i=n(14),o=r.forwardRef((function(e,t){var n=e.classes,i=e.className,o=Object(a.a)(e,["classes","className"]);return r.createElement("div",Object(c.a)({className:Object(s.a)(n.root,i),ref:t},o))}));o.muiName="ListItemSecondaryAction",t.a=Object(i.a)({root:{position:"absolute",right:16,top:"50%",transform:"translateY(-50%)"}},{name:"MuiListItemSecondaryAction"})(o)},1096:function(e,t,n){"use strict";n.r(t);var c=n(2),a=n(1),r=n(22),s=n(4),i=n(12),o=n(40),j=n(1001),u=n(20),l=n(61),b=n(948),d=n(362),O=n(516),h=n(958),m=n(963),f=n(950),x=n(1007),g=n(1014),v=n(15),p=n(27),S=n.n(p),y=n(37),k=n.n(y),w=n(1032),C=n(267),N=n(14),F=n(55),T=function(e){var t=e.event,n=Object(F.a)(),a=t.resource;return Object(c.jsx)("div",{style:{backgroundColor:a.lesson.course.subject.userRelation.color,width:8,height:8,borderRadius:n.shape.borderRadius}})},D=n(1011),I=n(305),R=n(230),E=n(361),L=n(321),M=function(e){var t=e.label,n=e.onNavigate;return Object(c.jsx)(d.a,{children:Object(c.jsxs)(D.a,{container:!0,direction:"row",alignItems:"center",justify:"center",children:[Object(c.jsx)(D.a,{item:!0,children:Object(c.jsx)(I.a,{onClick:function(){return n(L.navigate.PREVIOUS)},children:Object(c.jsx)(E.c,{})})}),Object(c.jsx)(D.a,{item:!0,children:Object(c.jsx)(R.a,{onClick:function(){return n(L.navigate.TODAY)},children:t})}),Object(c.jsx)(D.a,{item:!0,children:Object(c.jsx)(I.a,{onClick:function(){return n(L.navigate.NEXT)},children:Object(c.jsx)(E.d,{})})})]})})},z=Object(N.a)(l.Y)((function(e){var t=e.absences,n=e.classes,a=e.date,r=e.onDateChange,s=t.map((function(e){return{allDay:!0,start:e.lesson.date.toDate(),end:e.lesson.date.toDate(),title:e.id,resource:e}}));return Object(c.jsx)(C.a,{popup:!0,events:s,view:"month",views:["month"],localizer:v.o,style:{height:400},date:a.toDate(),className:n.root,components:{eventWrapper:T,toolbar:M},onNavigate:function(e){return r(S()(e))}})})),A=n(1008),U=n(1009),V=n(1004),G=n(1035),Y=n(1010),B=n(1044),J=n(1e3),W=n(67),P=n(1036),Q=function(e){var t=e.id,n=e.lesson,r=e.onUpdate,s=e.isSigned,j=e.reason,d=Object(b.a)().t,h=Object(F.a)(),m=Object(o.Q)(),f=n.course.subject.userRelation.color,x=Object(u.a)(f,h.palette.background.paper),g=Object(i.a)(x,2),p=g[0],S=g[1],y=Object(a.useState)(!1),k=Object(i.a)(y,2),w=k[0],C=k[1],N=Object(P.a)((function(e){return m(t,e)}),{onSuccess:r}).mutateAsync,T=n.course.subject.name,D=d("{{subject}}: {{startTime}} - {{endTime}}",{subject:T,startTime:n.startTime.format("LT"),endTime:n.endTime.format("LT")});return Object(c.jsx)(W.d,{enableReinitialize:!0,initialValues:{reason:j,isSigned:s},onSubmit:function(e,t){var n=t.setSubmitting,c=t.setErrors;return N(e).catch((function(e){var t;return c(null===(t=e.response)||void 0===t?void 0:t.data)})).finally((function(){return n(!1)}))},children:function(e){var t=e.isSubmitting,a=e.submitForm,r=e.values,s=e.setFieldValue;return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsxs)(A.a,{button:!0,onClick:function(){return C((function(e){return!e}))},children:[Object(c.jsx)(U.a,{children:Object(c.jsx)(V.a,{href:Object(v.a)("/agenda/lesson/detail/:id",{id:n.id}),underline:"none",children:Object(c.jsx)(G.a,{style:{backgroundColor:S,color:p},children:n.course.subject.shortName.substring(0,3)})})}),Object(c.jsx)(Y.a,{primary:D,secondary:r.reason}),Object(c.jsx)(B.a,{children:Object(c.jsx)(W.b,{name:"isSigned",component:I.a,edge:"end",size:"small",onClick:function(){s("isSigned",!r.isSigned),a()},children:Object(c.jsx)(E.O,{style:{opacity:r.isSigned?1:.2}})})})]}),Object(c.jsx)(J.a,{in:w,children:Object(c.jsx)(O.a,{py:1,px:3,children:Object(c.jsx)(l.F,{isLoading:t,children:Object(c.jsx)(W.c,{children:Object(c.jsx)(W.b,{component:l.a,label:d("Grund"),name:"reason",onBlur:a})})})})})]})}})},X={width:"100%"};t.default=function(){var e=Object(o.h)(),t=Object(u.m)(),n=Object(b.a)().t,p=Object(l.bb)(),y=Object(a.useState)(),C=Object(i.a)(y,2),N=C[0],F=C[1],T=Object(a.useState)(!1),D=Object(i.a)(T,2),I=D[0],R=D[1],E=Object(a.useState)(!1),L=Object(i.a)(E,2),M=L[0],A=L[1],U=Object(a.useState)(S.a),V=Object(i.a)(U,2),G=V[0],Y=V[1],B=Object(j.a)(["fetch_absences",G,I,M],(function(){return e({lessonDateMin:G.date(1),lessonDateMax:G.date(G.daysInMonth()),isSigned:!I&&void 0,containsReason:!M&&void 0})}),Object(s.a)(Object(s.a)({},t),{},{onSuccess:function(e){return F(e.results)}})),J=B.isError,W=B.isLoading,P=Object(a.useMemo)((function(){if(!N)return[];var e=Object(v.l)(N,{getValue:function(e){return e.lesson.date.toISOString()}});return Object.entries(e).filter((function(e){var t=Object(i.a)(e,2),n=(t[0],t[1]);return Boolean(n.length)}))}),[N]);if(W&&!N)return Object(c.jsx)(l.G,{title:n("Fehlstunden werden geladen")});if(J&&!N)return Object(c.jsx)(l.n,{description:n("Fehlstunden konnten nicht geladen werden.")});var $=function(e,t){if(N){var n=N.findIndex((function(e){return e.id===t.id}));return F((function(e){return k()(e,Object(r.a)({},n,{$set:t}))}))}};return Object(c.jsx)(l.k,{children:Object(c.jsx)(d.a,{style:X,children:N&&Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(z,{absences:N,date:G,onDateChange:Y}),Object(c.jsxs)(O.a,{my:2,px:2,children:[Object(c.jsx)(h.a,{control:Object(c.jsx)(m.a,{checked:I,onChange:function(e){return R(e.target.checked)}}),label:n("Unterschriebene Fehlstunden ausblenden")}),Object(c.jsx)(h.a,{control:Object(c.jsx)(m.a,{checked:M,onChange:function(e){return A(e.target.checked)}}),label:n("Fehlstunden nur mit leerem Grund anzeigen")})]}),Object(c.jsxs)(O.a,{mt:2,alignItems:"center",justifyContent:"center",display:"flex",children:[W&&Object(c.jsx)(f.a,{}),J&&Object(c.jsx)(w.a,{severity:"error",children:n("Weitere Fehlstunden konnten nicht geladen werden.")})]}),Object(c.jsx)(x.a,{subheader:Object(c.jsx)("li",{}),className:p.root,children:P.map((function(e,t){var n=Object(i.a)(e,2),r=n[0],o=n[1];return Object(c.jsx)(O.a,{component:"li",mt:5*Number(!t),children:Object(c.jsxs)("ul",{children:[Object(c.jsx)(g.a,{children:S()(r).format("ll")}),o.map((function(e){return Object(a.createElement)(Q,Object(s.a)(Object(s.a)({},e),{},{key:e.id,onUpdate:function(t){return $(e.id,t)}}))}))]})},r)}))})]})})})}}}]);